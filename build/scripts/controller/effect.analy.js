lbiApp.controller("effect.analyCtrl",["$scope","SweetAlert","$state","lbiService",function(a,b,c,d){var e=function(b){b.coupons_buy_percent=(100*b.coupons_buy_num/b.coupons_click_count).toFixed(2)+"%",b.coupons_written_percent=(100*b.coupons_written_num/b.coupons_buy_num).toFixed(2)+"%",b.to_store_percent=(100*b.to_store_num/b.toshop_click_num).toFixed(2)+"%",a.totalStat=b},f=function(b){var c=$.map(a.clickItems.concat(a.effectItems),function(a){return a.type}),d={};$.each(b,function(b,e){$.each(c,function(b,c){val="coupons_buy_percent"==c?Number((100*e.coupons_buy_num/e.coupons_click_count).toFixed(2)):"coupons_written_percent"==c?Number((100*e.coupons_written_num/e.coupons_buy_num).toFixed(2)):"to_store_percent"==c?Number((100*e.to_store_num/e.toshop_click_num).toFixed(2)):e[c],d[c]?(d[c].xAxis.categories.push(""+e.createtime),d[c].series[0].data.push(val)):d[c]={xAxis:{categories:[""+e.createtime]},series:[{name:$.grep(a.clickItems.concat(a.effectItems),function(a){return a.type==c})[0].name,data:[val]}]}})}),a.detailStat=d};a.isSuffixPercent=function(a){return-1!=$.inArray(a,["coupons_buy_percent","coupons_written_percent","to_store_percent"])},a.$on("$stateChangeSuccess",function(b,c,g){return g.id?(a.startDate=g.startdate,a.endDate=g.enddate,void(g.startdate&&g.enddate&&d("getEffectAnalysis",{endDate:g.enddate,startDate:g.startdate,activityid:g.id}).then(function(a){e(a[0].totals[0]),f(a[0].details)}))):!1}),a.$watch("startDate",function(a){return a?void c.go("index.effect.analy",{startdate:a}):!1}),a.$watch("endDate",function(a){return a?void c.go("index.effect.analy",{enddate:a}):!1}),a.clickItems=[{type:"page_click_count",name:"页面"},{name:"优惠券",type:"coupons_click_count"},{name:"进入店铺",type:"toshop_click_count"},{name:"电话咨询",type:"call_click_count"}],a.clickSingeType="page_click_count",a.effectItems=[{type:"coupons_buy_num",name:"优惠券购买人数"},{name:"优惠券销售数量",type:"coupons_sale_num"},{name:"优惠券核销数量",type:"coupons_written_num"},{name:"到店人数",type:"to_store_num"},{name:"购买率",type:"coupons_buy_percent"},{name:"成交率",type:"coupons_written_percent"},{name:"到店率",type:"to_store_percent"}],a.effectSingeType="coupons_buy_num"}]);