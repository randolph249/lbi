lbiApp.controller("mySet.shopCtrl",["$scope","lbiService","$upload","userStatus","SweetAlert","$state",function(a,b,c,d,e){var f,g,h,i;d.then(function(a){i=a.memberId}),a.uploadStatus="unstart",b("getFiles","POST").then(function(b){switch(b[0].isfinish){case 0:a.uploadStatus="unstart";break;case-1:a.fileName=b[0].title,a.uploadStatus="ing";break;case 1:a.total=b[0].total,a.count=b[0].count,a.percent=(100*a.count/a.total).toFixed(0),a.fileName=b[0].title,a.uploadStatus="complete",h=b[0].id}}),a.uploadFile=function(b){a.upload(b)},a.upload=function(b){var d=b[0];return"-1"==d.name.indexOf(".csv")?(j("文件格式错误"),!1):(f=a.uploadStatus,g=a.fileName,a.uploadStatus="crossing",a.progress=0,void c.upload({url:"/lbi/brand/upload",fields:{memberId:i},fileFormDataName:"userfile",file:b[0]}).progress(function(b){a.progress=b.loaded/b.total}).success(function(c){return c.success?(a.fileName=b[0].name,void(a.uploadStatus="ing")):(j(),!1)}))};var j=function(b){e.swal({title:"上传失败!",text:"失败原因:"+b,confirmButtonColor:"#399eee",confirmButtonText:"确定"},function(){a.uploadStatus=f,a.fileName=g})}}]);