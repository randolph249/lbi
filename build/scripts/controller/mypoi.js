lbiApp.controller("mySet.poiCtrl",["$scope","myPoiResource","SweetAlert","queryPlaceBySearchPoi",function(a,b,c,d){a.checkcity=function(b){a.cityname=b.cityname,a.citycode=b.citycode,a.citylnglat={lng:b.x,lat:b.y}},a.pois=[],b.query().then(function(b){b.length||(a.displayPoiEdit=!0),a.pois=b,a.curPoi=b[0].type}),a.$watch("curPoi+citycode",function(){return a.citycode&&a.curPoi?(a.layerkeyword=$.grep(a.pois,function(b){return b.type==a.curPoi})[0].desc,void d({city:a.citycode,type:a.curPoi,key:a.layerkeyword}).then(function(b){a.aboutPoiCount=b.count},function(){a.aboutPoiCount=0})):!1}),a.openEditInterface=function(){a.displayPoiEdit=!0,a.$broadcast("UPDATE_CHECKED_POIS",a.pois)},a.delPoi=function(d,f){c.swal({title:"确定删除兴趣点"+d.desc+"?",confirmButtonText:"确定",confirmButtonColor:"#399eee",cancelButtonText:"取消",cancelButtonColor:"#f0f0f0",showCancelButton:!0},function(){a.pois.splice(f,1),b.del({type:d.type}),e()})},a.$on("UPDATE_MY_POIS",function(b,c){a.pois=c,a.displayPoiEdit=!1,e()}),a.$on("CANCEL_EDIT_MY_POIS",function(){a.displayPoiEdit=!1});var e=function(){var b=$.grep(a.pois,function(b){return b.type==a.curPoi});b.length||(a.curPoi=a.pois[0].type)}}]),lbiApp.controller("mySet.poi.editCtrl",["$scope","myPoiResource","lbiService",function(a,b,c){a.pois=[],a.$on("UPDATE_CHECKED_POIS",function(b,c){a.pois=c});var d=function(b){return $.grep(a.pois,function(a){return a.type==b}).length};a.delPoi=function(c,d){a.pois.splice(d,1),b.del({type:c.type})},a.hotPois={},c("recommendPois").then(function(b){a.hotPois=b[0]}),a.typeahead={datasets:{source:function(a,b){c("searchPois",{desc:a}).then(function(a){b(a.splice(0,15))})},templates:{empty:['<div class="search-empty">',"没有找到相关的POI信息","</div>"].join("\n"),suggestion:Handlebars.compile(['<div class="search-result">','<p class="search-result-poiname">',"{{level3}}",'<i class="iconfont icon-check"></i>',"</p>","</div>"].join(""))}},options:{highlight:!0}},a.$on("typeahead:selected",function(a,b){e(b)}),a.selectHotpoi=function(a){e(a)};var e=function(c){return d(c.type)?!1:(a.pois.push({desc:c.level3,type:c.type}),void b.add({type:c.type}))};a.confirmEdit=function(){a.$emit("UPDATE_MY_POIS",a.pois)},a.cancelEdit=function(){a.$emit("CANCEL_EDIT_MY_POIS")}}]);