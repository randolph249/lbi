var lbiApp=angular.module("lbiApp");lbiApp.controller("createMemberInfoCtrl",["$scope","lbiService","$state",function(a,b,c){function d(){c.go("root.normal")}function e(){return""==a.params.circletype?a.permissionflag=!1:""==$.trim(a.params.name)?a.permissionflag=!1:a.params.brandId&&a.params.brandcatid&&a.params.categoryId?(a.permissionflag=!0,!0):(a.permissionflag=!1,!1)}a.step=1,a.params={},a.permissionflag=!1,a.displayCatList=!1,a.displayBrandList=!1,a.$on("UPDATE_CATLISTDISPLAY",function(b,c){a.displayCatList=c}),a.$on("UPDATE_BRANDLISTDISPLAY",function(b,c){a.displayBrandList=c}),a.$on("ADDCIRCLE_PARAMS",function(b,c){return a.params=$.extend(!0,a.params,c),c.hasOwnProperty("circletype")?(a.step=2,!1):c.hasOwnProperty("brandId")?(a.step=3,!1):void 0}),a.$watch("params",function(){e()},!0),a.completeSet=function(){b("addBaseInfo",function(a){a.success(function(a){a.success&&d()})},a.params,"POST")}}]),lbiApp.controller("createCircleCtrl",["$scope","lbiService","safeApply",function(a,b,c){var d=function(b){var c=a.citylist,e=-1;return $.each(c,function(a,c){return c.cityname==b?e=a:void 0}),-1==e?(d(a.defaultcity),!1):(a.curPoiMsg.city=c[e].cityname,a.curPoiMsg.index=e,a.curPoiMsg.poiname=c[e].poiname,a.curPoiMsg.citycode=c[e].citycode,void(a.curPoiMsg.lnglat=[c[e].lng,c[e].lat]))},e=function(){return a.permissionflag=""==a.circletype?!1:""==$.trim(a.name)?!1:a.radius&&a.curPoiMsg.lnglat&&a.curPoiMsg.lnglat.length?!0:!1};a.permissionflag=!1,a.defaultcity=DEFAULT_CITY,a.citylist=CITY_LIST,a.citycodelist=[],a.curPoiMsg={index:0,cityname:"",poiname:"",lnglat:[]},b("getLocation",function(a){a.success(function(a){var b=a.info[0].city.replace(/\d+,/,"").replace(/^\s+|\s+$/g,"");d(b)})}),a.$watch("curPoiMsg.city",function(b,c){b!==c&&d(a.curPoiMsg.city)}),a.typeahead={},a.typeahead.datasets={name:"states",source:function(b,c){var d=a.$on("UPDATE_DATASOURCE",function(a,b){c(b),"function"==$.type(d)&&d()});return!1},displayKey:"name"},a.typeahead.options={highlight:!0},a.$on("typeahead:selected",function(b,d){c(a,function(){a.curPoiMsg.poiname=d.name,a.curPoiMsg.lnglat=[d.location.lng,d.location.lat]})}),a.radius=3e3,a.slidebar={options:{range:"min",value:a.radius,min:0,max:7e3,step:100}},a.$watch("circletype+name+radius+curPoiMsg.lnglat",function(){e()}),a.emitToParent=function(){a.$emit("ADDCIRCLE_PARAMS",{circletype:a.circletype,name:a.name,radius:a.radius,city:a.curPoiMsg.city,x:a.curPoiMsg.lnglat[0],y:a.curPoiMsg.lnglat[1]})}}]),lbiApp.controller("creatCatBrand",["$scope","lbiService","broadcastBetweenCtrls",function(a,b,c){function d(){return a.permissionflag=a.checked_brand&&a.checked_cat?!0:!1}a.checked_cat={},a.checked_brand={},a.showCatList=function(){a.$emit("UPDATE_CATLISTDISPLAY",!0)},a.showBrandList=function(){a.$emit("UPDATE_BRANDLISTDISPLAY",!0)},a.checked_cat=!1,a.checked_brand=!1,c.on("BROADCAST_CHECKED_CAT",function(b){a.checked_cat=b}),c.on("BROADCAST_CHECKED_BRAND",function(b){a.checked_brand=b}),a.permissionflag=!1,a.emitToParent=function(){a.$emit("ADDCIRCLE_PARAMS",{brandId:a.checked_brand.brand_id,brandcatid:a.checked_brand.brandcatid,categoryId:a.checked_cat.id})},a.$watch("checked_cat.id+checked_brand.brandId",function(){d()}),a.$on("$destroy",function(){c.off("BROADCAST_CHECKED_CAT"),c.off("BROADCAST_CHECKED_BRAND")})}]),lbiApp.controller("catListCtrl",["$scope","lbiService","commonDataShare","broadcastBetweenCtrls","safeApply",function(a,b,c,d){a.$watch("displayCatList",function(){return a.displayCatList?void c("categlory_labels",function(b){a.level1=b}):!1}),a.getLevelData=function(){var b="";return function(c,d){b=c,setTimeout(function(){b==c&&(a["level"+d]=[],a.requestLevelData(c,d))},400)}}(),a.requestLevelData=function(c,d){b("get_categlorys",function(b){b.success(function(b){a["level"+d]=b.info})},{categoryId:c})},a.chooseCat=function(b){a.checked_cat=b},a.broadcastCheckedCat=function(){d.trigger("BROADCAST_CHECKED_CAT",a.checked_cat),a.$emit("UPDATE_CATLISTDISPLAY",!1)},a.hideCatList=function(){a.$emit("UPDATE_CATLISTDISPLAY",!1)}}]),lbiApp.controller("brandListCtrl",["$scope","commonDataShare","lbiService","broadcastBetweenCtrls",function(a,b,c,d){a.checked_brand={},a.$watch("displayBrandList",function(){return a.displayBrandList?void b("categlory_labels",function(b){a.level1=b}):!1}),a.getBrandData=function(){var b="";return function(c,d){b=c,setTimeout(function(){b==c&&a.requestBrandData(c,d)},200)}}(),a.requestBrandData=function(b,d){c("get_brands",function(c){c.success(function(c){a.brandlist=c.info,$.each(a.brandlist,function(a,c){c.brandcatname=d,c.brandcatid=b})})},{categoryId:b})},a.chooseBrand=function(b){a.checked_brand=b},a.broadcastCheckedBrand=function(){d.trigger("BROADCAST_CHECKED_BRAND",a.checked_brand),a.$emit("UPDATE_BRANDLISTDISPLAY",!1)},a.hideBrandList=function(){a.$emit("UPDATE_BRANDLISTDISPLAY",!1)}}]);