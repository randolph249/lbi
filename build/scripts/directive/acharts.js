lbiApp.directive("brixChart",[function(){var a=function(b){return"function"==$.type(AChart)?(b(),!1):(setTimeout(function(){a(b)},100),!1)};return{scope:{datasource:"@",type:"@"},link:function(b,c,d){function e(a,b){switch(chart=void 0,c.empty(),a){case"pie":f(b);break;case"bar":g(b);break;case"bar2":drawBar2(b);break;case"line":h(b);break;case"map":i(b);break;case"":draw}}function f(a){var b=0;$.each(a,function(a,c){b=+Number(c)});var c=function(a){var b=[];return $.each(a,function(a,c){b.push({name:a,y:Number(c)})}),b},d=c(a),e=new AChart({theme:AChart.Theme.Base,id:j,width:m,height:n,plotCfg:{margin:[10,120,10,10]},tooltip:{pointRenderer:function(a){return(100*a.percent).toFixed(2)+"%"}},seriesOptions:{pieCfg:{colors:["#F74D7D","#6280A1","#5BCB8A","#B0704A","#937ACC","#6280A1","#45B5E6","#5BCB8A"],allowPointSelect:!0,labels:{distance:-20,label:{fill:"#e5e5e5"},renderer:function(a,b){return(100*b.point.percent).toFixed(1)+"%"}},innerSize:"30%"}},series:[{type:"pie",name:l,data:d,legendType:"circle",legend:{dy:10,dx:200,layout:"vertical",align:"top",strokeWidth:0,back:{stroke:null}}}]});return e.render(),!1}function g(a){var b=[],c=[],d=0;Object.keys&&(b=Object.keys(a)),$.each(a,function(a,c){Object.keys||b.push(a),d+=Number(c)}),$.each(a,function(a,b){c.push(Number((100*b/d).toFixed(2)))});var e=new AChart({colors:["#937ACC"],theme:AChart.Theme.Base,id:j,width:m,height:n,legend:null,plotCfg:{margin:[10,10,50,30]},xAxis:{categories:b,labels:{label:{rotate:-45,"text-anchor":"end"}}},yAxis:{min:0,labels:{renderer:function(a){return a+"%"}}},tooltip:{valueSuffix:"%"},series:[{name:l,type:"column",autoWidth:!0,data:c,labels:{label:{rotate:-90,y:10,fill:"#fff","text-anchor":"end","text-shadow":"0 0 3px black","font-size":"12px"},renderer:function(a){return a+"%"}}}]});return e.render(),!1}function h(a){var b=d.valuesuffix||"",c=new AChart($.extend(!0,a,{colors:["#937ACC"],theme:AChart.Theme.Base,id:j,width:m,height:n,legend:null,plotCfg:{margin:[10,10,50,30]},xAxis:{labels:{label:{rotate:m/a.xAxis.categories.length>40?0:-45,"text-anchor":"end"}}},yAxis:{min:0,labels:{renderer:function(a){return a+b}}},tooltip:{valueSuffix:b,crosshairs:!0}}));return c.render(),!1}function i(a){return!1}b.datasource={};var j=d.id,k=d.type,l=d.xlabel||"",m=$(c).width(),n=$(c).height();b.$watch("datasource",function(){var c=b.datasource;return"string"!=$.type(c)||""==c?!1:(c=JSON.parse(c),void a(function(){e(k,c)}))})}}}]);