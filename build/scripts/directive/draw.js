function Canvas2D(a,b){function c(){var c=document.getElementById("tile_gid_canvas_ele");return c||(c=document.createElement("canvas"),c.id="tile_gid_canvas_ele",c.width=a,c.height=b,c.style.display="none",document.body.appendChild(c)),c}this.width=a,this.height=b,this.ele=c(),this.canvas=this.ele.getContext("2d"),this.clearRect()}function Legend(){this.colors=["#EEEA27","#B1CE24","#48A935","#176A58","#1D386F","#522661","#D72229"]}function html5Draw(a,b,c,d,e,f,g){var h=new TMap,i=new Legend,j=h.getTileBounds(a,b,c),k=h.correctBounds(e),l="http://www.maptiler.org/img/none.png?x="+a+"&y="+b+"&z="+c;if(!h.intersectsBounds(k,j))return l;for(var m=new Canvas2D(256,256),n=h.getTilePixBounds(a,b,c),o=!1,p=0;p<d.length;p++){var q=d[p],r=h.getBoundByGid(q,f);if(h.intersectsBounds(j,r)&&h.intersectsBounds(k,r)){o=!0;var s=q.split("_"),t=(s[0]+"_"+s[1],parseInt(s[2])),u=h.getRectCanvasRegion(n,q,f,c);m.addRect(u,i.getAutoColor(g,t))}}if(o){var v=m.createImage();return v}return l}Canvas2D.prototype={createImage:function(){var a=this.ele.toDataURL("image/png");return a},addRect:function(a,b){var c=a.getWidth(),d=a.getHeight();this.canvas.beginPath(),this.canvas.fillStyle=b,this.canvas.fillRect(a.left,a.top,c,d),this.canvas.closePath()},clearRect:function(){var a=this.width,b=this.height;this.canvas.clearRect(0,0,a,b)},deleteCanvas:function(){this.ele&&this.ele.parentNode.removeChild(this.ele),this.ele=null}},Legend.prototype.getColor=function(a){return 150>a?this.colors[0]:300>a?this.colors[1]:450>a?this.colors[2]:600>a?this.colors[3]:750>a?this.colors[4]:1e3>a?this.colors[5]:this.colors[6]},Legend.prototype.getAutoColor=function(a,b){for(var c=this.colors.length,d=0;d<a.length;d++){var e=d%c;if(b<=a[d])return this.colors[e]}};