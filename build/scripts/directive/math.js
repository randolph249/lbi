function PixBound(a,b,c,d){this.left=a,this.top=b,this.getWidth=function(){return Math.abs(c-a)},this.getHeight=function(){return Math.abs(d-b)}}function TMap(){this.mercator_r=20037508.34,this.MinLatitude=-85.05112878,this.MaxLatitude=85.05112878,this.MinLongitude=-180,this.MaxLongitude=180}TMap.prototype={Clip:function(a,b,c){return Math.min(Math.max(a,b),c)},PixelToLngLat:function(a,b){var c=a.x,d=a.y,e=this.MapSize(b),f=this.Clip(c,0,e-1)/e-.5,g=.5-this.Clip(d,0,e-1)/e,h=90-360*Math.atan(Math.exp(2*-g*Math.PI))/Math.PI,i=360*f;return new AMap.LngLat(i,h)},LngLatToPixel:function(a,b){var c=a.lat,d=a.lng,e=this.MinLatitude,f=this.MaxLatitude,g=this.MinLongitude,h=this.MaxLongitude;c=this.Clip(c,e,f),d=this.Clip(d,g,h);var i,j,k=(d+180)/360,l=Math.sin(c*Math.PI/180),m=.5-Math.log((1+l)/(1-l))/(4*Math.PI),n=this.MapSize(b);return i=this.Clip(k*n+.5,0,n-1),j=this.Clip(m*n+.5,0,n-1),new AMap.Pixel(i,j)},MapSize:function(a){return 256*Math.pow(2,a)},lonLat2Mercator:function(a){var b=a.lng*this.mercator_r/180,c=Math.PI,d=Math.log(Math.tan((90+a.lat)*c/360))/(c/180);d=d*this.mercator_r/180;var e={X:b,Y:d};return e},mercator2LonLat:function(a){var b=a.X/this.mercator_r*180,c=a.Y/this.mercator_r*180,d=Math.PI,c=180/d*(2*Math.atan(Math.exp(c*d/180))-d/2),e=new AMap.LngLat(b,c);return e},getTileBounds:function(a,b,c){var d=256*a,e=256*b,f=new AMap.Pixel(d,e),g=new AMap.Pixel(f.x,f.y+255),h=new AMap.Pixel(f.x+255,f.y),i=this.PixelToLngLat(g,c),j=this.PixelToLngLat(h,c);return new AMap.Bounds(i,j)},getDistance:function(a,b){var c=a.lat*Math.PI/180,d=b.lat*Math.PI/180,e=12756274*Math.asin(Math.sqrt(Math.pow(Math.sin((c-d)/2),2)+Math.cos(c)*Math.cos(d)*Math.pow(Math.sin((a.lng-b.lng)*Math.PI/180/2),2)));return e},intersectsBounds:function(a,b){var c=!1,d={left:a.getSouthWest().lng,right:a.getNorthEast().lng,top:a.getNorthEast().lat,bottom:a.getSouthWest().lat},e={left:b.getSouthWest().lng,right:b.getNorthEast().lng,top:b.getNorthEast().lat,bottom:b.getSouthWest().lat},f=d.left==e.right||d.right==e.left||d.top==e.bottom||d.bottom==e.top;if(f)return!0;var g=e.bottom>=d.bottom&&e.bottom<=d.top||d.bottom>=e.bottom&&d.bottom<=e.top,h=e.top>=d.bottom&&e.top<=d.top||d.top>e.bottom&&d.top<e.top,i=e.left>=d.left&&e.left<=d.right||d.left>=e.left&&d.left<=e.right,j=e.right>=d.left&&e.right<=d.right||d.right>=e.left&&d.right<=e.right;return c=(g||h)&&(i||j)},getGidsByBound:function(a,b){for(var c=new AMap.LngLat(a.getSouthWest().lng,a.getSouthWest().lat),d=new AMap.LngLat(a.getNorthEast().lng,a.getNorthEast().lat),e=this.lonLat2Mercator(c),f=parseInt(Math.floor((e.X-b)/b)),g=parseInt(Math.floor((e.Y-b)/b)),h=this.lonLat2Mercator(d),i=parseInt(Math.ceil(h.X/b)),j=parseInt(Math.ceil(h.Y/b)),k=new Array,l=f;i>=l;l++)for(var m=g;j>=m;m++){var n={X:l*b,Y:m*b},o={X:(l+1)*b,Y:(m+1)*b},p=this.mercator2LonLat(n),q=this.mercator2LonLat(o),r=p.lng,s=p.lat,t=q.lng,u=q.lat,v=new AMap.LngLat(r,s),w=new AMap.LngLat(t,u),x=new AMap.Bounds(v,w);this.intersectsBounds(a,x)&&k.push(l+"_"+m)}return k},calulateGids:function(a,b,c){var d=this.getTileBounds(a,b,c),e=this.getGidSize(d),f=e.gidsize,g=e.gidname,h=this.getGidsByTile(d,f);return{gidname:g,gids:h}},getBoundByGid:function(a,b){var c=a.split("_"),d=parseFloat(c[0]),e=parseFloat(c[1]),f=d*b,g=e*b,h=f+b,i=g+b,j={X:f,Y:g},k={X:h,Y:i},l=this.mercator2LonLat(j),m=this.mercator2LonLat(k),n=new AMap.Bounds(l,m);return n},getMerBoundByGid:function(a,b){var c=a.split("_"),d=parseFloat(c[0]),e=parseFloat(c[1]),f=d*b,g=e*b,h=f+b,i=g+b,j={X:f,Y:g},k={X:h,Y:i};return{sw:j,ne:k}},getTilePixBounds:function(a,b){var c=256*a,d=256*b,e=new AMap.Pixel(c,d),f=new AMap.Pixel(e.x,e.y+255),g=new AMap.Pixel(e.x+255,e.y);return{sw:f,ne:g}},getGidPixBound:function(a,b,c){var d=a.split("_"),e=parseFloat(d[0]),f=parseFloat(d[1]),g=e*b,h=f*b,i=g+b,j=h+b,k={X:g,Y:h},l={X:i,Y:j},m=this.mercator2LonLat(k),n=this.mercator2LonLat(l),o=this.LngLatToPixel(m,c),p=this.LngLatToPixel(n,c);return{sw:o,ne:p}},getTileMerBounds:function(a,b,c){var d=this.ZoomToResolution(c),e=20037508.342789244,f=256*a*d-e,g=256*(Math.pow(2,c)-1-b)*d-e,h=256*(a+1)*d-e,i=256*(Math.pow(2,c)-b)*d-e,j={X:f,Y:g},k={X:h,Y:i};return{sw:j,ne:k}},getRectCanvasRegion:function(a,b,c,d){var e={X:a.sw.x,Y:a.ne.y},f=({X:a.ne.x,Y:a.sw.y},this.getGidPixBound(b,c,d)),g={X:f.sw.x,Y:f.ne.y},h={X:f.ne.x,Y:f.sw.y};return new PixBound(g.X-e.X,g.Y-e.Y,h.X-e.X,h.Y-e.Y)},correctBounds:function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d=b.lng,e=b.lat,f=c.lng,g=c.lat;d>f&&(d=c.lng,f=b.lng),e>g&&(e=c.lat,g=b.lat);var h=new AMap.LngLat(d,e),i=new AMap.LngLat(f,g),j=new AMap.Bounds(h,i);return j},ZoomToResolution:function(a){var b=0;switch(a){case 1:b=78271.517;break;case 2:b=39135.7585;break;case 3:b=19567.8792;break;case 4:b=9783.9396;break;case 5:b=4891.9698;break;case 6:b=2445.9849;break;case 7:b=1222.9925;break;case 8:b=611.4962;break;case 9:b=305.7481;break;case 10:b=152.8741;break;case 11:b=76.437;break;case 12:b=38.2185;break;case 13:b=19.1093;break;case 14:b=9.5546;break;case 15:b=4.7773;break;case 16:b=2.3887;break;case 17:b=1.1943}return b}};